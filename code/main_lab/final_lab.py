# python -u ./code/main_lab/final_lab.py --log INFO

from domain.character import (
    Teacher,
    Student,
    ask_teacher,
    broadcast,
    all_forget,
    logger,
)
import domain.labtools as lab
from domain.aifile import Manager

teacher = Teacher("叶知秋")
Student("楚云舒", 0.1, 50)
Student("苏逸尘", 0.1, 50)
# Student("林诗韵", 0.1, 50)
# Student("叶清风", 0.1, 50)
# Student("沈婉兮", 0.1, 50)
# Student("陆子衿", 0.1, 50)
# Student("萧逸轩", 0.1, 50)
# Student("柳如烟", 0.1, 50)
# Student("方若曦", 0.1, 50)
# Student("谢景行", 0.1, 50)
# Student("苏沐阳", 0.1, 50)
# Student("楚辞韵", 0.1, 50)
# Student("林逸轩", 0.1, 50)
# Student("叶婉清", 0.1, 50)
# Student("陆锦书", 0.1, 50)
# Student("柳诗涵", 0.1, 50)

manager = Manager(cfg_path="./lab/file_cofig.json")
TEXT_BOOK = "./lab/通信电路与系统教学资料.md"

if manager.get_file(path=TEXT_BOOK) is None:
    manager.flush_file(path=TEXT_BOOK)

teacher.add_textbook(manager.get_file(TEXT_BOOK).id)

prompt = "[校长][杨校长]"

content = """现在进行教学任务安排：这个学期你是《通信电路与系统》这门课程的授课老师。
这门课程一共24个课时，教学资料为“通信电路与系统教学资料”，下面是这门课程的教学要求：

## 授课目标：
本课程使学生掌握通信系统的核心--无线通信射频系统的基础理论、射频电路设计与测试方法、射频系统和电路最新进展和未来方向，为学生今后开展通信电路与系统技术研究和产品开发打下坚实的基础。
本课程的射频电路理论学习与实际设计结合紧密，通过射频电路设计实验实践，使学生了解和掌握射频电路设计技能，着重培养学生发现问题、分析问题和解决问题的能力，提高学生的实践动手能力和创新能力，融合家国情怀与制度自信、科学精神与工匠精神、法治意识与工程伦理等课程思政元素，最终达到培养基础理论扎实、解决工程问题能力强、具有系统概念、热爱社会主义建设事业的高级专业技术人才的目标。

## 课程大纲：
1. 绪论
课时目标：使学生理解电磁波传播特性、无线通信信道媒介的特点、无线通信系统典型结构，掌握无线通信系统中射频前端电路功能与性能要求、射频电路特点，了解无线通信及射频电路技术现状与发展趋势。要求学生关注与了解射频电路技术发展中的一些重要进展及其背景，体会技术的创新与发展过程；要求学生学习无线电频谱管理，明白通信行业的生产、设计、研究与开发中需要遵循一些技术管理与规定。
(1) 电磁波传播特性、电磁波频段划分、无线通信信道特性与容量
(2)无线通信系统的典型结构、射频前端电路功能与特性
(3) 无线通信及射频电路技术发展趋势

2. 无线通信收发机系统结构
课时目标：使学生理解无线通信收发机的性能指标定义，掌握超外差式、零中频式、低中频式、数字中频式等各种无线通信接收机、发射机、收发机系统中射频前端电路的结构、特性及应用领域，了解典型的单芯片无线收发机射频前端结构和发展趋势。
(1) 无线通信收发机射频前端的性能指标
(2)无线通信接收机射频前端结构与特性
(3) 无线通信发射机射频前端结构与特性
(4) 典型的单芯片无线收发机射频前端结构与特性

3. 传输线理论
课时目标：使学生了各类传输线的结构、特性及在射频电路中的应用，理解和掌握传输线的集总元件电路模型和电报方程；理解传输线上的电压波传播特性和波的特征参量、传输线特征阻抗的物理意义，掌握端接负载的无耗传输线的输入阻抗计算方法；掌握端接开路、短路等特殊终端的无耗传输线的输入阻抗及在射频电路中的应用。
(1) 传输线类型及其集总元件电路模型
(2) 电报方程与电压波传播特性
(3) 端接负载的传输线的输入阻抗
(4) 端接特殊（开路/短路）负载的传输线在射频电路中的应用

4. 射频网络参数与分析
课时目标：使学生理解射频网络的Z参数、Y参数、H参数、T/ABCD参数、散射参数的定义、物理意义、测量方法及应用条件，掌握各网络参数互相转换的计算方法、S参数与阻抗的关系及应用。
(1) Z/Y/H/T/ABCD参数与网络分析
(2) 散射（S）参数与网络分析

5. Smith圆图与阻抗转换
课时目标：使学生理解阻抗与反射系数之间的一一对应关系，掌握Smith阻抗、导纳、阻抗-导纳圆图定义、特点及应用方法；了解阻抗转换（匹配）的功能，2元件L-型/3元件PI-型及T-型等集中元件式、传输线式、集中元件-传输线组合式等基本阻抗转换电路的拓扑结构及特点；掌握解析法、Smith圆图法设计阻抗匹配电路的方法。
(1) Smith圆图
(2) 串并联谐振回路及选频特性
(3) 阻抗转换电路与设计

6. 通信系统噪声和非线性失真
课时目标：使学生理解电路与系统中的各类噪声产生机理及其产生的效应，掌握噪声性能参数-等效噪声温度、噪声系数的定义，二端口网络级联链路噪声系数的计算方法；理解电路与系统中存在整流、谐波、增益压缩、交调等非线性现象的机理及效应，掌握P1dB、IP3等非线性特性参数的定义，以及二端口网络级联链路的IP3的计算方法；理解无线通信接收机灵敏度、动态范围的定义，掌握无线收发链路性能指标分析与计算方法。
(1)噪声及特性分析
(2)非线性及特性分析
(3) 无线通信收发链路性能指标分析

7. 通信系统功能电路--射频滤波器
课时目标：使学生了解LPF、HPF、BPF、BSF等滤波器的基本电路结构及传输特性，理解插入损耗、带外抑制度、带宽、端口回波损耗等滤波器性能参数定义，掌握巴特沃斯、切比雪夫、高斯等无源低通、高通、带通、带阻滤波器的设计方法。
(1) 滤波器基本结构与性能参数
(2) 低通滤波器原型电路
(3) 滤波器设计方法

8. 通信系统功能电路--射频放大器
课时目标：使学生了解射频放大器的功能、种类及性能参数定义，掌握射频放大器的基本电路拓扑结构、原理及特性，掌握放大器的设计步骤与性能分析方法。
(1)放大器性能参数及相关理论
(2) 放大器基本结构及功能电路设计

现在，基于课程的教学要求，独立给出结构清晰详细的课程安排和授课方案，完成你自己课程开始前的准备工作，不允许和学生交流。"""

ans = ask_teacher(prompt + content)
print("===\n" + ans)

# idxs = [i+1 for i in range(24)]
idxs = [i + 1 for i in range(2)]

for idx in idxs:
    logger.info(f"==第{idx}节课==")

    broadcast(
        f"{prompt}上课通知：同学们，现在准备开始学习《通信电路与系统》的第{idx}节课，本堂课的任课老师是叶知秋，请同学们安静，停止交流，等待叶知秋老师上课。收到通知后请立刻回复“收到”。"
    )

    ask_teacher(
        f"{prompt}现在开始上《通信电路与系统》第{idx}节课，请按照你的教学计划，根据你的教学计划，完成你的教学任务，向学生教授这节课的知识内容。完成教学任务后，总结这次的教学效果。"
    )

    ask_teacher(
        prompt + "现在是教学活动安排时间，安排一次小组讨论，以本节课的内容为主题。"
    )

    broadcast(
        prompt
        + "现在是答疑时间，同学们如果有疑问可以向老师提问请教，问题尽量简单，禁止反复追问，禁止占用太多时间。"
    )

    broadcast(
        prompt
        + "现在下课，同学们自由安排，可以和同学相互交流，也可以自己整理复习这堂课的学习内容。"
    )

    broadcast(f"{prompt}整理汇总《中国近代文学赏析》的第{idx}节课的学习内容。")

    all_forget()

# broadcast(
#     prompt
#     + "现在所有课程都已经结束，在这次的《中国近代文学赏析》课程中，你学到了什么，你觉得《故乡》是一部什么样的作品？做一个简单的学习汇报总结。"
# )

# broadcast(
#     prompt
#     + "《中国近代文学赏析》课程已经结课，你觉得授课老师王建国老师的教学怎么样？你对王老师如何评价？你觉得他还有哪些地方可以提升？"
# )

# lab.create_json_script()
